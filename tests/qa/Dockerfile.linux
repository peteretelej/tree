# Ubuntu-based testing environment for tree CLI
FROM ubuntu:22.04

# Set environment variables
ENV RUST_VERSION=stable
ENV DEBIAN_FRONTEND=noninteractive

# Install system dependencies
RUN apt-get update && apt-get install -y \
    curl \
    build-essential \
    git \
    ca-certificates \
    && rm -rf /var/lib/apt/lists/*

# Install Rust
RUN curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y --default-toolchain stable
ENV PATH="/root/.cargo/bin:${PATH}"

# Verify Rust installation
RUN rustc --version && cargo --version

# Set working directory
WORKDIR /app

# Copy the entire project
COPY . .

# Make test script executable
RUN chmod +x /app/tests/qa/qa-docker-test.sh

# Default command runs the QA tests
CMD ["./tests/qa/qa-docker-test.sh"]